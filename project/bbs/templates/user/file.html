<!--
author: Edgar
文件显示
TODO: 如何显示，显示的具体内容
-->
{% extends 'user/base.html' %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}我的文件 {% endblock %}</title>
</head>
<body>
{% block detail %}
    <table class="layui-table ">
    <colgroup>
    <col width="200">
    <col width="150">
    <col width="100">
    <col width="200">
    <col width="100">
    <col>
  </colgroup>
        <tr style="text-align: center">
            <th>文件名</th>
            <th>文件类型</th>
            <th>下载次数</th>
            <th>上传时间</th>
            <th>操作</th>
        </tr>
        <tbody>
        {% for file in files %}
            <tr>
                <td>{{ file.name }}</td>
                <td>{{ file.exp_type }}</td>
                <td>{{ file.downloads }}</td>
                <td>{{ file.date }}</td>
                <td>
                    <div class="layui-row">
                        <a href="{{ file.path }}" download="{{ file.name }}" class="layui-table-link layui-inline">
                            <div class="layui-icon layui-icon-download-circle "></div>
                        </a>  &nbsp;&nbsp;  <a href="javascript:void (0);" onclick="deleteFileById({{ file.id }})" class="layui-table-link layui-inline">
                        <div class="layui-icon layui-icon-delete" style="color: red"></div>
                    </a></div>
                </td>
            </tr>
        {% endfor %}
        </tbody>
        {% csrf_token %}

    </table>

{% endblock %}
</body>
{% block back_dependencies %}
    <script>
        function deleteFileById(id) {
            layui.use('layer', function () {
                let layer = layui.layer;

                layer.open({
                    type: 1,
                    id:"delete",
                    area: ["250px", "150px"],
                    btn: ["删除", "取消"],
                    scrollbar: false,
                    content: "<div style='text-align: center; margin-top: 20px'>确定删除文件?</div>",
                    isOutAnim:false,
                    yes: function () {
                        let cookies = document.cookie.split(',');
                        let pattern = /csrftoken=(.*)/m;
                        let csrf;
                        for (let j = 0; j < cookies.length; j++) {
                            if (pattern.test(cookies[j])) {
                                csrf = pattern.exec(cookies[j])[1];
                            }
                        }
                        $.ajax({
                            type: "POST",
                            url: ".",
                            data: {id},
                            headers: {
                                "X-CSRFToken": csrf
                            },
                            success: function (data) {
                                location.reload();
                            },
                            error: function () {
                                layer.msg("删除失败")
                            }

                        })
                    },

                    btn2: function () {
                        layer.close(layer.open());
                    },
                    cancel:function () {

                    }
                });

            });
        }

    </script>
{% endblock %}
</html>